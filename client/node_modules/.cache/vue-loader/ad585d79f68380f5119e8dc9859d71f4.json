{"remainingRequest":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ralfzonneveld/Documents/Repositories/20:21/webdevüßë‚Äçüíª-20:21/Bloom/client/src/views/chat/chatDetail.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/ralfzonneveld/Documents/Repositories/20:21/webdevüßë‚Äçüíª-20:21/Bloom/client/src/views/chat/chatDetail.vue","mtime":1623684370517},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/ralfzonneveld/Documents/Repositories/20:21/webdevüßë‚Äçüíª-20:21/Bloom/client/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIkAvY29tcG9uZW50cy9jaGF0L2NoYXREZXRhaWwuc2NzcyI7Cg=="},{"version":3,"sources":["chatDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmQA","file":"chatDetail.vue","sourceRoot":"src/views/chat","sourcesContent":["<template>\n  <section class=\"chat-detail\">\n    <header>\n      <router-link to=\"/chats\" class=\"start\">\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"7.246\"\n          height=\"11.941\"\n          viewBox=\"0 0 7.246 11.941\"\n          style=\"display: block; transform: scale(-1, 1)\"\n        >\n          <path\n            id=\"Path_13\"\n            data-name=\"Path 13\"\n            d=\"M3.431-4.786a.656.656,0,0,0,0-.928l-5.314-5.314a.656.656,0,0,0-.928,0l-.62.62a.656.656,0,0,0,0,.927L.779-5.25-3.432-1.019a.656.656,0,0,0,0,.927l.62.62a.656.656,0,0,0,.928,0Z\"\n            transform=\"translate(3.623 11.22)\"\n            fill=\"#f07904\"\n          />\n        </svg>\n      </router-link>\n      <router-link :to=\"'/buddies/' + participant[0].id\">\n        <div :class=\"participant[0].profileAvatar\">\n          <p>\n            {{ createInitials(participant[0].firstName, participant[0].surName) }}\n          </p>\n        </div>\n\n        <h2>\n          {{ participant[0].firstName }}\n          {{ participant[0].surName }}\n        </h2>\n      </router-link>\n      <svg\n        id=\"Iconly_Bulk_More_Circle\"\n        data-name=\"Iconly/Bulk/More Circle\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n      >\n        <path\n          id=\"Fill_1\"\n          data-name=\"Fill 1\"\n          d=\"M20,10A10,10,0,1,1,10,0,10,10,0,0,1,20,10\"\n          transform=\"translate(2 2)\"\n          fill=\"#f07904\"\n          opacity=\"0.4\"\n        />\n        <path\n          id=\"Combined_Shape\"\n          data-name=\"Combined Shape\"\n          d=\"M8.959,1.2a1.2,1.2,0,1,1,1.2,1.2A1.2,1.2,0,0,1,8.959,1.2Zm-4.479,0a1.2,1.2,0,1,1,1.2,1.2A1.2,1.2,0,0,1,4.479,1.2ZM0,1.2a1.2,1.2,0,1,1,1.2,1.2A1.2,1.2,0,0,1,0,1.2Z\"\n          transform=\"translate(6.323 10.804)\"\n          fill=\"#f07904\"\n        />\n      </svg>\n    </header>\n\n    <main>\n      <ul>\n        <li v-for=\"(item, index) in messagesHistory[0]\" :key=\"index\">\n          <div v-if=\"item.sender !== $store.state.user._id\" class=\"other\">\n            <p>{{ item.content }}</p>\n          </div>\n\n          <div v-else class=\"me\">\n            <p>{{ item.content }}</p>\n          </div>\n        </li>\n\n        <div v-if=\"messages.length\">\n          <li v-for=\"(item, index) in messages\" :key=\"index\">\n            <div v-if=\"item.sender !== $store.state.user._id\" class=\"other\">\n              <p>{{ item.content }}</p>\n            </div>\n\n            <div v-else class=\"me\">\n              <p>{{ item.content }}</p>\n            </div>\n          </li>\n        </div>\n      </ul>\n\n      <div v-if=\"requestAccepted == false && viewCreater == false\">\n        <button @click=\"makeRequestChoice('reject')\">Afwijzen</button>\n        <button @click=\"makeRequestChoice('accept')\">Accepteren</button>\n      </div>\n\n      <form v-else @submit.prevent=\"send\">\n        <div>\n          <input type=\"text\" v-model=\"newMessage\" placeholder=\"Typ een chatbericht...\" required />\n          <svg\n            id=\"Voice\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n            width=\"17\"\n            height=\"20\"\n            viewBox=\"0 0 17 20\"\n          >\n            <path\n              id=\"Fill_1\"\n              data-name=\"Fill 1\"\n              d=\"M16.031,0a.962.962,0,0,0-.969.957,6.563,6.563,0,0,1-13.125,0A.962.962,0,0,0,.969,0,.962.962,0,0,0,0,.957,8.443,8.443,0,0,0,7.532,9.293v1.925a.969.969,0,0,0,1.937,0V9.293A8.443,8.443,0,0,0,17,.957.962.962,0,0,0,16.031,0\"\n              transform=\"translate(0 7.826)\"\n              fill=\"#726d61\"\n              opacity=\"0.4\"\n            />\n            <path\n              id=\"Fill_4\"\n              data-name=\"Fill 4\"\n              d=\"M4.351,13.217H4.7a4.325,4.325,0,0,0,4.351-4.3V4.3A4.324,4.324,0,0,0,4.7,0H4.351A4.324,4.324,0,0,0,0,4.3V8.921a4.325,4.325,0,0,0,4.351,4.3\"\n              transform=\"translate(3.973 0)\"\n              fill=\"#726d61\"\n            />\n          </svg>\n        </div>\n\n        <button type=\"submit\">send</button>\n      </form>\n    </main>\n  </section>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport io from \"socket.io-client\";\nimport moment from \"moment\";\n\nexport default {\n  name: \"ChatDetail\",\n\n  data() {\n    return {\n      requestAccepted: false,\n      viewCreater: false,\n      socket: null,\n      messagesHistory: [],\n      participant: [],\n      newMessage: null,\n      messages: [],\n    };\n  },\n\n  created() {\n    this.socket = io(\"http://localhost:5000\");\n  },\n\n  mounted() {\n    this.socket.emit(\"joinRoom\", {\n      userID: this.$store.state.user._id,\n      roomID: this.$route.params.id,\n    });\n\n    this.socket.on(\"roomData\", ({ room, participant }) => {\n      // Store participant\n      let participantData = participant;\n      this.participant.push(participantData);\n\n      let userID = this.$store.state.user._id;\n      // Check if this is a chatRequest, then put request to true\n      let requestState = room.request.accepted;\n      let requestCreater = room.request.creater;\n\n      // check if chatCreatorID is the same as this user --> render chat\n      if (requestCreater == userID) {\n        // set view to viewCreater: false\n        this.viewCreater = true;\n      }\n\n      if (requestState == true) {\n        this.requestAccepted = true;\n      }\n\n      // Store messages history\n      let messages = room.messages;\n      this.messagesHistory.push(messages);\n    });\n\n    this.socket.on(\"newMessage\", (messageObject) => {\n      // console.log(\"New Message: \", messageObject);\n      this.messages.push(messageObject);\n    });\n  },\n\n  methods: {\n    // Get the initials of the name\n    createInitials(firstName, surName) {\n      let fullName = `${firstName} ${surName}`;\n\n      // Logic for getting the name initials\n      let rgx = new RegExp(/(\\p{L}{1})\\p{L}+/, \"gu\");\n      let initials = [...fullName.matchAll(rgx)] || [];\n      initials = ((initials.shift()?.[1] || \"\") + (initials.pop()?.[1] || \"\")).toUpperCase();\n      return initials;\n    },\n\n    // Chat request handler\n    async makeRequestChoice(choice) {\n      if (choice === \"reject\") {\n        // console.log(choice);\n        let chatID = this.$route.params.id;\n        let url = `${window.location.origin}/api/deleteChat/${chatID}`;\n\n        axios\n          .get(url)\n          .then((response) => {\n            let errorMsg = response.data;\n            // console.log(\"response: \", errorMsg);\n            this.$router.push(\"/chats\");\n            // succesfull afwijzing feedback msg\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n\n        // delete chat and go back to /chats\n      } else {\n        this.requestAccepted = true;\n\n        let createrID = this.participant[0].id;\n        let chatID = this.$route.params.id;\n        let url = `${window.location.origin}/api/acceptChat/${createrID}/${chatID}`;\n\n        axios\n          .get(url)\n          .then((response) => {\n            let errorMsg = response.data;\n            console.log(\"response: \", errorMsg);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n\n        // set in db state to true + here (this.requestAccepted)\n        // chatbar appears\n      }\n    },\n\n    // Send messages handler\n    send(e) {\n      e.preventDefault();\n      let date = new Date();\n      let formattedDate = moment(date).format(\"DD-MM-YYYY, hh:mm a\");\n\n      let chatObject = {\n        roomID: this.$route.params.id,\n        sender: this.$store.state.user._id,\n        content: this.newMessage,\n        time: formattedDate,\n      };\n\n      this.socket.emit(\"chat-message\", chatObject);\n      this.newMessage = null;\n      // this.$refs.newMsg.focus();\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n@import \"@/components/chat/chatDetail.scss\";\n</style>\n"]}]}