{"remainingRequest":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ralfzonneveld/Documents/Repositories/20:21/webdevüßë‚Äçüíª-20:21/Bloom/client/src/views/chat/chatDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ralfzonneveld/Documents/Repositories/20:21/webdevüßë‚Äçüíª-20:21/Bloom/client/src/views/chat/chatDetail.vue","mtime":1623684370517},{"path":"/usr/local/lib/node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/lib/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/usr/local/lib/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCBpbyBmcm9tICJzb2NrZXQuaW8tY2xpZW50IjsKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDaGF0RGV0YWlsIiwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJlcXVlc3RBY2NlcHRlZDogZmFsc2UsCiAgICAgIHZpZXdDcmVhdGVyOiBmYWxzZSwKICAgICAgc29ja2V0OiBudWxsLAogICAgICBtZXNzYWdlc0hpc3Rvcnk6IFtdLAogICAgICBwYXJ0aWNpcGFudDogW10sCiAgICAgIG5ld01lc3NhZ2U6IG51bGwsCiAgICAgIG1lc3NhZ2VzOiBbXSwKICAgIH07CiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuc29ja2V0ID0gaW8oImh0dHA6Ly9sb2NhbGhvc3Q6NTAwMCIpOwogIH0sCgogIG1vdW50ZWQoKSB7CiAgICB0aGlzLnNvY2tldC5lbWl0KCJqb2luUm9vbSIsIHsKICAgICAgdXNlcklEOiB0aGlzLiRzdG9yZS5zdGF0ZS51c2VyLl9pZCwKICAgICAgcm9vbUlEOiB0aGlzLiRyb3V0ZS5wYXJhbXMuaWQsCiAgICB9KTsKCiAgICB0aGlzLnNvY2tldC5vbigicm9vbURhdGEiLCAoeyByb29tLCBwYXJ0aWNpcGFudCB9KSA9PiB7CiAgICAgIC8vIFN0b3JlIHBhcnRpY2lwYW50CiAgICAgIGxldCBwYXJ0aWNpcGFudERhdGEgPSBwYXJ0aWNpcGFudDsKICAgICAgdGhpcy5wYXJ0aWNpcGFudC5wdXNoKHBhcnRpY2lwYW50RGF0YSk7CgogICAgICBsZXQgdXNlcklEID0gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5faWQ7CiAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgYSBjaGF0UmVxdWVzdCwgdGhlbiBwdXQgcmVxdWVzdCB0byB0cnVlCiAgICAgIGxldCByZXF1ZXN0U3RhdGUgPSByb29tLnJlcXVlc3QuYWNjZXB0ZWQ7CiAgICAgIGxldCByZXF1ZXN0Q3JlYXRlciA9IHJvb20ucmVxdWVzdC5jcmVhdGVyOwoKICAgICAgLy8gY2hlY2sgaWYgY2hhdENyZWF0b3JJRCBpcyB0aGUgc2FtZSBhcyB0aGlzIHVzZXIgLS0+IHJlbmRlciBjaGF0CiAgICAgIGlmIChyZXF1ZXN0Q3JlYXRlciA9PSB1c2VySUQpIHsKICAgICAgICAvLyBzZXQgdmlldyB0byB2aWV3Q3JlYXRlcjogZmFsc2UKICAgICAgICB0aGlzLnZpZXdDcmVhdGVyID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHJlcXVlc3RTdGF0ZSA9PSB0cnVlKSB7CiAgICAgICAgdGhpcy5yZXF1ZXN0QWNjZXB0ZWQgPSB0cnVlOwogICAgICB9CgogICAgICAvLyBTdG9yZSBtZXNzYWdlcyBoaXN0b3J5CiAgICAgIGxldCBtZXNzYWdlcyA9IHJvb20ubWVzc2FnZXM7CiAgICAgIHRoaXMubWVzc2FnZXNIaXN0b3J5LnB1c2gobWVzc2FnZXMpOwogICAgfSk7CgogICAgdGhpcy5zb2NrZXQub24oIm5ld01lc3NhZ2UiLCAobWVzc2FnZU9iamVjdCkgPT4gewogICAgICAvLyBjb25zb2xlLmxvZygiTmV3IE1lc3NhZ2U6ICIsIG1lc3NhZ2VPYmplY3QpOwogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2gobWVzc2FnZU9iamVjdCk7CiAgICB9KTsKICB9LAoKICBtZXRob2RzOiB7CiAgICAvLyBHZXQgdGhlIGluaXRpYWxzIG9mIHRoZSBuYW1lCiAgICBjcmVhdGVJbml0aWFscyhmaXJzdE5hbWUsIHN1ck5hbWUpIHsKICAgICAgbGV0IGZ1bGxOYW1lID0gYCR7Zmlyc3ROYW1lfSAke3N1ck5hbWV9YDsKCiAgICAgIC8vIExvZ2ljIGZvciBnZXR0aW5nIHRoZSBuYW1lIGluaXRpYWxzCiAgICAgIGxldCByZ3ggPSBuZXcgUmVnRXhwKC8oXHB7TH17MX0pXHB7TH0rLywgImd1Iik7CiAgICAgIGxldCBpbml0aWFscyA9IFsuLi5mdWxsTmFtZS5tYXRjaEFsbChyZ3gpXSB8fCBbXTsKICAgICAgaW5pdGlhbHMgPSAoKGluaXRpYWxzLnNoaWZ0KCk/LlsxXSB8fCAiIikgKyAoaW5pdGlhbHMucG9wKCk/LlsxXSB8fCAiIikpLnRvVXBwZXJDYXNlKCk7CiAgICAgIHJldHVybiBpbml0aWFsczsKICAgIH0sCgogICAgLy8gQ2hhdCByZXF1ZXN0IGhhbmRsZXIKICAgIGFzeW5jIG1ha2VSZXF1ZXN0Q2hvaWNlKGNob2ljZSkgewogICAgICBpZiAoY2hvaWNlID09PSAicmVqZWN0IikgewogICAgICAgIC8vIGNvbnNvbGUubG9nKGNob2ljZSk7CiAgICAgICAgbGV0IGNoYXRJRCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZDsKICAgICAgICBsZXQgdXJsID0gYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vYXBpL2RlbGV0ZUNoYXQvJHtjaGF0SUR9YDsKCiAgICAgICAgYXhpb3MKICAgICAgICAgIC5nZXQodXJsKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGxldCBlcnJvck1zZyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJyZXNwb25zZTogIiwgZXJyb3JNc2cpOwogICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgiL2NoYXRzIik7CiAgICAgICAgICAgIC8vIHN1Y2Nlc2Z1bGwgYWZ3aWp6aW5nIGZlZWRiYWNrIG1zZwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgICB9KTsKCiAgICAgICAgLy8gZGVsZXRlIGNoYXQgYW5kIGdvIGJhY2sgdG8gL2NoYXRzCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yZXF1ZXN0QWNjZXB0ZWQgPSB0cnVlOwoKICAgICAgICBsZXQgY3JlYXRlcklEID0gdGhpcy5wYXJ0aWNpcGFudFswXS5pZDsKICAgICAgICBsZXQgY2hhdElEID0gdGhpcy4kcm91dGUucGFyYW1zLmlkOwogICAgICAgIGxldCB1cmwgPSBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9hcGkvYWNjZXB0Q2hhdC8ke2NyZWF0ZXJJRH0vJHtjaGF0SUR9YDsKCiAgICAgICAgYXhpb3MKICAgICAgICAgIC5nZXQodXJsKQogICAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICAgIGxldCBlcnJvck1zZyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJyZXNwb25zZTogIiwgZXJyb3JNc2cpOwogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgICB9KTsKCiAgICAgICAgLy8gc2V0IGluIGRiIHN0YXRlIHRvIHRydWUgKyBoZXJlICh0aGlzLnJlcXVlc3RBY2NlcHRlZCkKICAgICAgICAvLyBjaGF0YmFyIGFwcGVhcnMKICAgICAgfQogICAgfSwKCiAgICAvLyBTZW5kIG1lc3NhZ2VzIGhhbmRsZXIKICAgIHNlbmQoZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgbGV0IGZvcm1hdHRlZERhdGUgPSBtb21lbnQoZGF0ZSkuZm9ybWF0KCJERC1NTS1ZWVlZLCBoaDptbSBhIik7CgogICAgICBsZXQgY2hhdE9iamVjdCA9IHsKICAgICAgICByb29tSUQ6IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCwKICAgICAgICBzZW5kZXI6IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuX2lkLAogICAgICAgIGNvbnRlbnQ6IHRoaXMubmV3TWVzc2FnZSwKICAgICAgICB0aW1lOiBmb3JtYXR0ZWREYXRlLAogICAgICB9OwoKICAgICAgdGhpcy5zb2NrZXQuZW1pdCgiY2hhdC1tZXNzYWdlIiwgY2hhdE9iamVjdCk7CiAgICAgIHRoaXMubmV3TWVzc2FnZSA9IG51bGw7CiAgICAgIC8vIHRoaXMuJHJlZnMubmV3TXNnLmZvY3VzKCk7CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["chatDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"chatDetail.vue","sourceRoot":"src/views/chat","sourcesContent":["<template>\n  <section class=\"chat-detail\">\n    <header>\n      <router-link to=\"/chats\" class=\"start\">\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"7.246\"\n          height=\"11.941\"\n          viewBox=\"0 0 7.246 11.941\"\n          style=\"display: block; transform: scale(-1, 1)\"\n        >\n          <path\n            id=\"Path_13\"\n            data-name=\"Path 13\"\n            d=\"M3.431-4.786a.656.656,0,0,0,0-.928l-5.314-5.314a.656.656,0,0,0-.928,0l-.62.62a.656.656,0,0,0,0,.927L.779-5.25-3.432-1.019a.656.656,0,0,0,0,.927l.62.62a.656.656,0,0,0,.928,0Z\"\n            transform=\"translate(3.623 11.22)\"\n            fill=\"#f07904\"\n          />\n        </svg>\n      </router-link>\n      <router-link :to=\"'/buddies/' + participant[0].id\">\n        <div :class=\"participant[0].profileAvatar\">\n          <p>\n            {{ createInitials(participant[0].firstName, participant[0].surName) }}\n          </p>\n        </div>\n\n        <h2>\n          {{ participant[0].firstName }}\n          {{ participant[0].surName }}\n        </h2>\n      </router-link>\n      <svg\n        id=\"Iconly_Bulk_More_Circle\"\n        data-name=\"Iconly/Bulk/More Circle\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n      >\n        <path\n          id=\"Fill_1\"\n          data-name=\"Fill 1\"\n          d=\"M20,10A10,10,0,1,1,10,0,10,10,0,0,1,20,10\"\n          transform=\"translate(2 2)\"\n          fill=\"#f07904\"\n          opacity=\"0.4\"\n        />\n        <path\n          id=\"Combined_Shape\"\n          data-name=\"Combined Shape\"\n          d=\"M8.959,1.2a1.2,1.2,0,1,1,1.2,1.2A1.2,1.2,0,0,1,8.959,1.2Zm-4.479,0a1.2,1.2,0,1,1,1.2,1.2A1.2,1.2,0,0,1,4.479,1.2ZM0,1.2a1.2,1.2,0,1,1,1.2,1.2A1.2,1.2,0,0,1,0,1.2Z\"\n          transform=\"translate(6.323 10.804)\"\n          fill=\"#f07904\"\n        />\n      </svg>\n    </header>\n\n    <main>\n      <ul>\n        <li v-for=\"(item, index) in messagesHistory[0]\" :key=\"index\">\n          <div v-if=\"item.sender !== $store.state.user._id\" class=\"other\">\n            <p>{{ item.content }}</p>\n          </div>\n\n          <div v-else class=\"me\">\n            <p>{{ item.content }}</p>\n          </div>\n        </li>\n\n        <div v-if=\"messages.length\">\n          <li v-for=\"(item, index) in messages\" :key=\"index\">\n            <div v-if=\"item.sender !== $store.state.user._id\" class=\"other\">\n              <p>{{ item.content }}</p>\n            </div>\n\n            <div v-else class=\"me\">\n              <p>{{ item.content }}</p>\n            </div>\n          </li>\n        </div>\n      </ul>\n\n      <div v-if=\"requestAccepted == false && viewCreater == false\">\n        <button @click=\"makeRequestChoice('reject')\">Afwijzen</button>\n        <button @click=\"makeRequestChoice('accept')\">Accepteren</button>\n      </div>\n\n      <form v-else @submit.prevent=\"send\">\n        <div>\n          <input type=\"text\" v-model=\"newMessage\" placeholder=\"Typ een chatbericht...\" required />\n          <svg\n            id=\"Voice\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n            width=\"17\"\n            height=\"20\"\n            viewBox=\"0 0 17 20\"\n          >\n            <path\n              id=\"Fill_1\"\n              data-name=\"Fill 1\"\n              d=\"M16.031,0a.962.962,0,0,0-.969.957,6.563,6.563,0,0,1-13.125,0A.962.962,0,0,0,.969,0,.962.962,0,0,0,0,.957,8.443,8.443,0,0,0,7.532,9.293v1.925a.969.969,0,0,0,1.937,0V9.293A8.443,8.443,0,0,0,17,.957.962.962,0,0,0,16.031,0\"\n              transform=\"translate(0 7.826)\"\n              fill=\"#726d61\"\n              opacity=\"0.4\"\n            />\n            <path\n              id=\"Fill_4\"\n              data-name=\"Fill 4\"\n              d=\"M4.351,13.217H4.7a4.325,4.325,0,0,0,4.351-4.3V4.3A4.324,4.324,0,0,0,4.7,0H4.351A4.324,4.324,0,0,0,0,4.3V8.921a4.325,4.325,0,0,0,4.351,4.3\"\n              transform=\"translate(3.973 0)\"\n              fill=\"#726d61\"\n            />\n          </svg>\n        </div>\n\n        <button type=\"submit\">send</button>\n      </form>\n    </main>\n  </section>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport io from \"socket.io-client\";\nimport moment from \"moment\";\n\nexport default {\n  name: \"ChatDetail\",\n\n  data() {\n    return {\n      requestAccepted: false,\n      viewCreater: false,\n      socket: null,\n      messagesHistory: [],\n      participant: [],\n      newMessage: null,\n      messages: [],\n    };\n  },\n\n  created() {\n    this.socket = io(\"http://localhost:5000\");\n  },\n\n  mounted() {\n    this.socket.emit(\"joinRoom\", {\n      userID: this.$store.state.user._id,\n      roomID: this.$route.params.id,\n    });\n\n    this.socket.on(\"roomData\", ({ room, participant }) => {\n      // Store participant\n      let participantData = participant;\n      this.participant.push(participantData);\n\n      let userID = this.$store.state.user._id;\n      // Check if this is a chatRequest, then put request to true\n      let requestState = room.request.accepted;\n      let requestCreater = room.request.creater;\n\n      // check if chatCreatorID is the same as this user --> render chat\n      if (requestCreater == userID) {\n        // set view to viewCreater: false\n        this.viewCreater = true;\n      }\n\n      if (requestState == true) {\n        this.requestAccepted = true;\n      }\n\n      // Store messages history\n      let messages = room.messages;\n      this.messagesHistory.push(messages);\n    });\n\n    this.socket.on(\"newMessage\", (messageObject) => {\n      // console.log(\"New Message: \", messageObject);\n      this.messages.push(messageObject);\n    });\n  },\n\n  methods: {\n    // Get the initials of the name\n    createInitials(firstName, surName) {\n      let fullName = `${firstName} ${surName}`;\n\n      // Logic for getting the name initials\n      let rgx = new RegExp(/(\\p{L}{1})\\p{L}+/, \"gu\");\n      let initials = [...fullName.matchAll(rgx)] || [];\n      initials = ((initials.shift()?.[1] || \"\") + (initials.pop()?.[1] || \"\")).toUpperCase();\n      return initials;\n    },\n\n    // Chat request handler\n    async makeRequestChoice(choice) {\n      if (choice === \"reject\") {\n        // console.log(choice);\n        let chatID = this.$route.params.id;\n        let url = `${window.location.origin}/api/deleteChat/${chatID}`;\n\n        axios\n          .get(url)\n          .then((response) => {\n            let errorMsg = response.data;\n            // console.log(\"response: \", errorMsg);\n            this.$router.push(\"/chats\");\n            // succesfull afwijzing feedback msg\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n\n        // delete chat and go back to /chats\n      } else {\n        this.requestAccepted = true;\n\n        let createrID = this.participant[0].id;\n        let chatID = this.$route.params.id;\n        let url = `${window.location.origin}/api/acceptChat/${createrID}/${chatID}`;\n\n        axios\n          .get(url)\n          .then((response) => {\n            let errorMsg = response.data;\n            console.log(\"response: \", errorMsg);\n          })\n          .catch((err) => {\n            console.log(err);\n          });\n\n        // set in db state to true + here (this.requestAccepted)\n        // chatbar appears\n      }\n    },\n\n    // Send messages handler\n    send(e) {\n      e.preventDefault();\n      let date = new Date();\n      let formattedDate = moment(date).format(\"DD-MM-YYYY, hh:mm a\");\n\n      let chatObject = {\n        roomID: this.$route.params.id,\n        sender: this.$store.state.user._id,\n        content: this.newMessage,\n        time: formattedDate,\n      };\n\n      this.socket.emit(\"chat-message\", chatObject);\n      this.newMessage = null;\n      // this.$refs.newMsg.focus();\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\">\n@import \"@/components/chat/chatDetail.scss\";\n</style>\n"]}]}